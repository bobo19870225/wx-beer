const  { PageModule } = require('@cloudbase/page-module');
const pageModule = new PageModule('tcb:sign_up');
const injectIoc = require('../util/injectIoc');
const { SAAS_RETURN_ERR } = require('../constant/errcode');


module.exports = async (name, params = {}) => {
  const { services: { tcbService: { }, loggerService, errService } } = injectIoc();

  loggerService.info({ content: `pageModule.${name}`, name, params });
  try {
    const { result: { code, msg, data } } = await pageModule.callMethod(name, params);
    if (code !== 0) {
      errService.throw(SAAS_RETURN_ERR[0], `${SAAS_RETURN_ERR[1]} ${msg}`);
    }
    loggerService.info({ content: 'pageModule.result', data });
    return true;
  } catch (error) {
    loggerService.error({ content: `pageModule.${name}`, name, params, error });
    errService.throw(SAAS_RETURN_ERR[0], `${SAAS_RETURN_ERR[1]}`);
  }
};
