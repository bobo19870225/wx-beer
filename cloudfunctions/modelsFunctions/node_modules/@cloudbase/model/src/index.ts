import { ICloudbase } from '@cloudbase/types'
import { ICloudbaseComponent } from '@cloudbase/types/component'
import { init } from '@cloudbase/wx-cloud-client-sdk'

declare const cloudbase: ICloudbase

const COMPONENT_NAME = 'models'

const getComponent = (cloudbase: ICloudbase): ICloudbaseComponent => ({
  name: COMPONENT_NAME,
  namespace: COMPONENT_NAME,
  entity: (init({
    callFunction: ((cloudbase as any).callFunction).bind(cloudbase),
    auth: ((cloudbase as any).auth).bind(cloudbase),
  })).models,
})

try {
  const component = getComponent(cloudbase)
  cloudbase.registerComponent(component)
} catch (e) { }

export function registerModel(app: ICloudbase) {
  try {
    const component = getComponent(app)
    app.registerComponent(component)
  } catch (e) {
    console.warn(e)
  }
}

export * from '@cloudbase/wx-cloud-client-sdk'
