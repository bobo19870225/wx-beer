const path = require('path')

const params = {
  context: path.resolve(__dirname, '../'),
  mode: 'production',
  watch: false,
  entry: path.resolve(__dirname, '../src/index.ts'),
  output: {
    path: path.resolve(__dirname, '../dist/miniprogram'),
    filename: 'index.js',
    library: `tcbauth`,
    libraryTarget: 'umd',
    umdNamedDefine: true,
    globalObject: 'typeof window !== "undefined"?window:this',
  },
  externals: {
    '@cloudbase/adapter-wx_mp': {
      root: 'tcbadaptermp',
      commonjs: '@cloudbase/adapter-wx_mp',
      commonjs2: '@cloudbase/adapter-wx_mp',
      amd: '@cloudbase/adapter-wx_mp',
    },
    '@cloudbase/oauth': {
      root: 'tcboauth',
      commonjs: '@cloudbase/oauth',
      commonjs2: '@cloudbase/oauth',
      amd: '@cloudbase/oauth',
    },
  },
  definePlugin: {
    'process.env.NODE_ENV': JSON.stringify('production'), // 注入环境变量，用于业务代码判断
    'globalThis.IS_MP_BUILD': true,
  },
}

module.exports = require('./web.prod.js')(params)
