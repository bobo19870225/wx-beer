import adapter from "@cloudbase/adapter-node";
import cloudbase from "@cloudbase/js-sdk";

const { sessionStorage } = adapter.genAdapter();

cloudbase.useAdapters(adapter);

const app = cloudbase.init({
  env: "bobby-env-0g62itrs2a2ad6aa",
});

/**
 * auth 初始化的时候要传入storage 和 captchaOptions.openURIWithCallback
 * 否则会用默认的，依赖于平台，在 nodejs 环境报错
 */
const auth = app.auth({
  storage: sessionStorage,
  captchaOptions: {
    openURIWithCallback: (...props: any) =>
      console.log("open uri with callback", ...props),
  },
});

/**
 * 剩下的使用和其他平台无异
 */
const main = async () => {
  await auth.signInAnonymously(); // 或者使用其他登录方式
  const ai = await app.ai();
  const hy = ai.createModel("hunyuan-beta"); // 创建模型
  const res = await hy.streamText({
    model: "hunyuan-lite",
    messages: [{ role: "user", content: "你好" }],
  });
  for await (let str of res.textStream) {
    console.log(str);
  }
};
main().then(() => console.log("done"));
